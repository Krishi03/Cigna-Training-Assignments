
Create table Products(
  PID NUMBER PRIMARY KEY,
  PNAME VARCHAR(100) NOT NULL,
  CATEGORY VARCHAR(100) NOT NULL,
  PRICE NUMBER CHECK (PRICE >= 0),
  QUANTITY NUMBER DEFAULT 0);
  
Create Table Customers(CID NUMBER PRIMARY KEY,
  FNAME VARCHAR(20) NOT NULL,
  LNAME VARCHAR(20) NOT NULL,
  EMAIL VARCHAR(50) UNIQUE,
  PHONE_NO VARCHAR(15) UNIQUE);
  
Create Table Orders(OID NUMBER PRIMARY KEY,
  cur_date DATE DEFAULT SYSDATE,
  TOTAL NUMBER CHECK(TOTAL >=0),
  CUST_ID NUMBER,
  CONSTRAINT Fk_table FOREIGN KEY (CUST_ID) REFERENCES Customers(CID) ON DELETE CASCADE);
  
Create Table OrderDetails(OrderDetailno NUMBER UNIQUE,
  QUANTITIES NUMBER CHECK(QUANTITIES >=0),
  ORDER_ID NUMBER,
  PRODUCT_ID NUMBER,
  CONSTRAINT Fk_OD FOREIGN KEY (ORDER_ID) REFERENCES Orders(OID) ON DELETE CASCADE,
  CONSTRAINT FK_NEW FOREIGN KEY (PRODUCT_ID) REFERENCES Products(PID) ON DELETE CASCADE);
  
  --INSERT STATEMENTS--
  
  INSERT INTO Products(PID,PNAME, CATEGORY, PRICE, QUANTITY) VALUES (1, 'Laptop' , 'Electronics', 85000, 10);

INSERT INTO Products(PID,PNAME, CATEGORY, PRICE, QUANTITY) VALUES (2, 'Headphones' , 'Electronics', 12000, 5);

INSERT INTO Customers(CID, FNAME, LNAME, EMAIL, PHONE_NO) VALUES (1, 'Krishi', 'Antad','krishiantad03@gmail.com', '+91 8496949262');

INSERT INTO Customers(CID, FNAME, LNAME, EMAIL, PHONE_NO) VALUES (2, 'Adeeb', 'Khan','adeebkhan@gmail.com', '+91 9900970473');

INSERT INTO Orders(OID, cur_date, TOTAL, CUST_ID) VALUES (1, SYSDATE +14, 97000,1);

INSERT INTO Orders(OID, cur_date, TOTAL, CUST_ID) VALUES (2, SYSDATE+15, 170000,2);

INSERT INTO Orderdetails(OrderDetailno,QUANTITIES, ORDER_ID, PRODUCT_ID) VALUES (1, 2, 1, 1);

--QUERIES---

1) SELECT PNAME, QUANTITY
FROM Products
WHERE QUANTITY<20;

2) SELECT c.FNAME, C.LNAME, SUM(p.PRICE * od.QUANTITIES) AS TOTAL_SPENT
FROM Customers c, orders o, Orderdetails od, Products p
WHERE c.CID=o.CUST_ID AND
                    o.OID= od.ORDER_ID AND
                    od.PRODUCT_ID=p.PID
GROUP BY c.FNAME,c.LNAME;

3) UPDATE PRODUCTS P JOIN Orderdetails OD ON P.PID=OD.PRODUCT_ID SET P.QUANTITY=P.QUANTITY-OD.QUANTITIES;

